# session configuration
# ===========================================================================

if-shell "which reattach-to-user-namespace 2>/dev/null" \
           "set -g default-command 'reattach-to-user-namespace -l ${SHELL}'" \
           "set -g default-command '${SHELL}'"

if-shell "[ $is_maneyko ]" \
           "set -g prefix 'M-a'" \
           "set -g prefix 'M-s'"

set -g default-terminal "screen-256color"
source-file $HOME/dotfiles/tmux/unbind_tmux.conf

# functions
# ===========================================================================
# M-s to create 4 splits
bind-key    'M-n'  new-window \; split-window -v \; split-window -h \;\
                   select-pane -U \; split-window -h \; select-pane -L \;\
                   resize-pane -D 12

bind-key     'n'   new-window \; split-window -h\; select-pane -L

# key-bindings
# ===========================================================================

bind-key      s    setw synchronize-panes \; display "Toggle Sync"

bind-key      b    split-window -v -c "#{pane_current_path}"
bind-key      v    split-window -h -c "#{pane_current_path}"
bind-key      c    new-window -c      "#{pane_current_path}"

bind-key -r   h    resize-pane -L
bind-key -r   j    resize-pane -D
bind-key -r   k    resize-pane -U
bind-key -r   l    resize-pane -R

bind-key -n 'M-h'  select-pane -L
bind-key -n 'M-j'  select-pane -D
bind-key -n 'M-k'  select-pane -U
bind-key -n 'M-l'  select-pane -R
bind-key -r Up     select-pane -U
bind-key -r Down   select-pane -D
bind-key -r Left   select-pane -L
bind-key -r Right  select-pane -R

bind-key -n 'M-0'  select-window -t :=0
bind-key -n 'M-1'  select-window -t :=1
bind-key -n 'M-2'  select-window -t :=2
bind-key -n 'M-3'  select-window -t :=3
bind-key -n 'M-4'  select-window -t :=4
bind-key -n 'M-5'  select-window -t :=5
bind-key -n 'M-6'  select-window -t :=6
bind-key -n 'M-7'  select-window -t :=7
bind-key -n 'M-8'  select-window -t :=8
bind-key -n 'M-9'  select-window -t :=9

bind-key    {      swap-pane -U
bind-key    }      swap-pane -D
bind-key -n 'M-['  copy-mode
bind-key -n 'M-]'  paste-buffer
bind-key    :      command-prompt
bind-key    p      previous-window

bind-key    'M-q'  confirm-before -p "kill-server? (y/n)"\
                                      kill-server
bind-key -n 'M-x'  kill-pane
bind-key      x    kill-pane
bind-key      q    kill-window

bind-key -t vi-copy v begin-selection
bind-key -t vi-copy y     copy-pipe "reattach-to-user-namespace pbcopy"
bind-key -t vi-copy Enter copy-pipe "reattach-to-user-namespace pbcopy"

bind-key r source-file ~/.tmux.conf \; display "Config Reloaded!"

# preferences
# ===========================================================================

# colors
tm_color_inactive='fg=colour19'
tm_color_active='fg=colour183'

set -g renumber-windows on      # renumber windows when a window is closed
set -g base-index 1             # start renumbering at 1
set -g repeat-time 750          # default is 500ms
if-shell "[ $(tmux -V | tr -cd '[:digit:]') -ge 21 ]" \
           "set -g mouse on" \
           "set -g mouse-select-pane on"
setw -g mode-keys vi            # vi bindings in copy mode
set -s escape-time 0            # escape has no meaning to tmux

setw -g pane-border-style        $tm_color_inactive
setw -g pane-active-border-style $tm_color_active
set -g status-bg black
set -g status-fg white
set -g status-left ""
set -g status-right "#(. ~/dotfiles/tmux/bar.sh)"
